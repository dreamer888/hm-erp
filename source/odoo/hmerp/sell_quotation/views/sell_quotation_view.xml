<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!-- 报价单 tree 视图 -->
    	<record id='sell_quotation_tree' model='ir.ui.view'>
        	<field name='name'>sell.quotation.tree</field>
        	<field name='model'>sell.quotation</field>
        	<field name='arch' type='xml'>
                <tree string='报价单' decoration-info="state=='draft'" decoration-muted="state=='cancel'">
            		<field name='date' optional="show"/>
            		<field name='name' optional="show"/>
            		<field name='user_id' optional="show"/>
            		<field name='partner_id' options="{'no_open': True, 'no_create': True}" optional="show"/>
                    <field name="contact" optional="show"/>
                    <field name='opportunity_id' optional="show"/>
					<field name='details' widget="html" optional="show"/>
					<field name='state' optional="show"/>
            	</tree>
        	</field>
    	</record>

    	<!-- 报价单 form 视图 -->
    	<record id='sell_quotation_form' model='ir.ui.view'>
        	<field name='name'>sell.quotation.form</field>
        	<field name='model'>sell.quotation</field>
        	<field name='arch' type='xml'>
            	<form string='报价单'>
            		<header>
						<button name="sell_quotation_submit" states="draft" string="提交审批" type="object"  class="oe_highlight"/>
            			<button name='sell_quotation_done' states='submit' string='同意' type='object' class='oe_highlight' groups="core.group_all_manager"/>
            			<button name="sell_quotation_draft" states="submit" string="拒绝" type="object" groups="core.group_all_manager"/>
                        <button name="action_cancel" string="作废" type="object" groups="core.group_all_manager"/>
						<field name='state' widget='statusbar' statusbar_visible="draft,submit,done,cancel"/>      
            		</header>
            		<sheet>
            			<group>
            				<group>
            					<field name='partner_id' required='1'
            						domain="[('c_category_id', '!=', False)]"
						        options="{'no_open': True, 'no_create': True}"
            						context="{'form_view_ref': 'core.customer_address_form'}"/>
            					<field name='partner_address_id' options="{'no_open': True, 'no_create': True}"/>
                                <field name="contact"/>
            				    <field name='mobile'/>
            					<field name='user_id'
                                       options="{'no_open': True, 'no_create': True}"/>
            				</group>
            				<group>
							    <field name='date'/>
            					<field name='opportunity_id' options="{'no_open': True, 'no_create': True}"/>
								<field name="pay_method" required="1" options="{'no_open': True, 'no_create': True}" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name='validate_to'/>
								<field name='term_id'/>
								<field name='pol'/>
								<field name='pod'/>
							</group>
            			</group>
            			<notebook>
            				<page name="lines" string="报价单行">
            					<field name='line_ids' context="{'readonly_by_pass': True}">
                 					<tree string='报价单行' editable='bottom'>
                 						<field name='goods_id' domain="[('not_saleable','=',False)]" optional="show"/>
                                        <field name='price' optional="show"/>
                                        <field name='tax_rate' optional="show"/>
                                        <field name='price_taxed' optional="show"/>
                 						<field name='qty' optional="show"/>
                 						<field name='uom_id' optional="show"/>
                                        <field name='c_code' optional="show"/>
                                        <field name='c_name' optional="show"/>
										<field name='lead_time' optional="show"/>
										<field name="partner_id" invisible="1" options="{'no_open': True, 'no_create': True}" optional="show"/>
										<field name="date" invisible="1" optional="show"/>
										<field name="state" invisible="1" optional="show"/>
				 					</tree>
				 				</field>
				 				<field name="note" placeholder="暂无备注信息"/>
				 			</page>
				 		</notebook>
            		</sheet>
                	<div class="oe_chatter">
                    	<field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    	<field name="message_ids" widget="mail_thread"/>
                	</div>
            	</form>
        	</field>
    	</record>

    	<record id="sell_quotation_search" model="ir.ui.view">
            <field name="name">sell.quotation.search</field>
            <field name="model">sell.quotation</field>
            <field name="arch" type="xml">
                <search string="报价单">
                    <field name="name"/>
                    <field name="partner_id"/>
					<field name="goods_id"/>
                    <field name="state"/>
                    <filter name="draft" string="草稿" domain="[('state','=','draft')]"/>
                    <filter name="done" string="已确认" domain="[('state','=','done')]"/>
                    <group expand="0" string="分组">
                        <filter name="by_part" string="客户" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter name="by_date" string="报价日期" domain="[]" context="{'group_by':'date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- 报价单 action -->
    	<record id='sell_quotation_action' model='ir.actions.act_window'>
        	<field name='name'>报价单</field>
        	<field name='res_model'>sell.quotation</field>
        	<field name='view_mode'>tree,form</field>
        	<field name='view_id' ref='sell_quotation_tree'/>
			<field name="context">{}</field>
        	<field name="help" type="html">
               <p class="oe_view_nocontent_create">
                	 点击创建报价单
               </p>
             </field>
    	</record>

		 <!-- 继承销售订单 form 视图 -->
        <record id="quotation_sell_order_form_inherit" model="ir.ui.view">
            <field name="name">quotation sell order form inherit</field>
            <field name="model">sell.order</field>
            <field name="inherit_id" ref="sell.sell_order_form"/>
            <field name="arch" type="xml">
				<xpath expr="//field[@name='line_ids']/tree/field[@name='price_taxed']" position='after'>
                    <field name="quotation_line_id" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='price_taxed']" position='attributes'>
                    <attribute name='invisible'>1</attribute>
                </xpath>
				<xpath expr="//field[@name='line_ids']/tree/field[@name='discount_rate']" position='attributes'>
                    <attribute name='invisible'>1</attribute>
                </xpath>
				<xpath expr="//field[@name='line_ids']/tree/field[@name='discount_amount']" position='attributes'>
                    <attribute name='invisible'>1</attribute>
                </xpath>
			</field>
		</record>

        <menuitem id='sell_quotation_menu' name='报价单' action='sell_quotation_action'
                  parent='sell.sell_order_menu_root' sequence='0' groups='sell.sell_groups'/>
    </data>
</openerp>
