<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id='batch_split_wizard_form' model='ir.ui.view'>
        <field name='name'>batch.split.wizard form</field>
        <field name='model'>batch.split.wizard</field>
        <field name='arch' type='xml'>
            <form string="拆分批次">
                <group>
                    <field name="move_line_id" invisible='1'/>
                    <field name="goods_id"/>
                    <field name="warehouse_id"/>
                    <field name="goods_qty"/>
                    <field name="line_ids">
                        <tree editable='bottom'>
                            <field name="lot"
                            invisible="context.get('type')!='in'"
                            />
                            <field name="expiration_date"
                            invisible="context.get('type')!='in'"
                            groups='warehouse.group_expiration_date'
                            />
                            <field name="lot_id"
                            invisible="context.get('type')=='in'"
                            options="{'no_open': True, 'no_create': True}"
                            domain="[('goods_id', '=', parent.goods_id), 
                                     ('state', '=', 'done'), 
                                     ('lot', '!=', False), 
                                     ('qty_remaining', '>', 0), 
                                     ('warehouse_dest_id', '=', parent.warehouse_id)]"
                            />
                            <field name="qty" sum="已拆分"/>
                        </tree>
                    </field>
                </group>
                <footer>
                    <button name="split_move_line" type="object" string="确定" class="oe_highlight"/>
                    或者
                    <button string="取消" class="oe_link" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    
    <record id="action_batch_split_act_window" model="ir.actions.act_window">
        <field name="type">ir.actions.act_window</field>
        <field name="name">批次拆分</field>
        <field name="res_model">batch.split.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
    
    <record id="view_sell_delivery_form_inherited" model="ir.ui.view">
        <field name="name">sell delivery inherited</field>
        <field name="model">sell.delivery</field>
        <field name="inherit_id" ref="sell.sell_delivery_form" />
        <field name="arch" type="xml">
            <field name='lot_id' position="after">
                <button name="%(warehouse_batch_split.action_batch_split_act_window)d"
                    string="拆分"
                    type="action"
                    groups='goods.batch_groups'
                    states='draft'
                />
            </field>
        </field>
    </record>
    <record id="view_sell_return_form_inherited" model="ir.ui.view">
        <field name="name">sell return inherited</field>
        <field name="model">sell.delivery</field>
        <field name="inherit_id" ref="sell.sell_return_form" />
        <field name="arch" type="xml">
            <field name='lot' position="after">
                <button name="%(warehouse_batch_split.action_batch_split_act_window)d"
                    string="拆分"
                    type="action"
                    groups='goods.batch_groups'
                    states='draft'
                />
            </field>
        </field>
    </record>
    <record id="view_buy_receipt_form_inherited" model="ir.ui.view">
        <field name="name">buy receipt inherited</field>
        <field name="model">buy.receipt</field>
        <field name="inherit_id" ref="buy.buy_receipt_form" />
        <field name="arch" type="xml">
            <field name='lot' position="after">
                <button name="%(warehouse_batch_split.action_batch_split_act_window)d"
                    string="拆分"
                    type="action"
                    groups='goods.batch_groups'
                    states='draft'
                />
            </field>
        </field>
    </record>
    <record id="view_buy_return_form_inherited" model="ir.ui.view">
        <field name="name">buy return inherited</field>
        <field name="model">buy.receipt</field>
        <field name="inherit_id" ref="buy.buy_return_form" />
        <field name="arch" type="xml">
            <field name='lot_id' position="after">
                <button name="%(warehouse_batch_split.action_batch_split_act_window)d"
                    string="拆分"
                    type="action"
                    groups='goods.batch_groups'
                    states='draft'
                />
            </field>
        </field>
    </record>
    
</odoo>

