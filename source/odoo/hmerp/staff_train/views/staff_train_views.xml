<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--培训管理根菜单-->
        <menuitem id='menu_staff_train' name='培训' parent='staff.menu_staff_root' sequence='10'/>

        <!--培训项目tree-->
        <record id='staff_program_tree' model='ir.ui.view'>
            <field name='name'>staff.program.tree</field>
            <field name='model'>staff.program</field>
            <field name='arch' type='xml'>
                <tree decoration-muted="active == False" string="培训项目" delete="0" multi_edit="1" sample="1">
                    <field name='name'/>
                    <field name='label_tasks'/>
                    <field name='user_id'/>
                    <field name='start_date'/>
                    <field name='end_date'/>
                    <field name='train_amount'/>
                    <field name='trainees'/>
                    <field name='train_Location'/>
                    <field name='active' optional="hide"/>
                    <field name='sequence' optional="hide"/>
                </tree>
            </field>
        </record>
        <!--培训项目filter-->
        <record id="view_staff_program_filter" model="ir.ui.view">
            <field name="name">staff.program.select</field>
            <field name="model">staff.program</field>
            <field name="arch" type="xml">
                <search string="Search Program">
                    <field name="name" string="项目名称"/>
                    <field name="user_id" string="项目主管"/>
                    <separator/>
                    <filter string="已归档" name="inactive" domain="[('active', '=', False)]"/>
                    <group expand="0" string="Group By">
                        <filter string="项目主管" name="Manager" context="{'group_by': 'user_id'}"/>
                        <filter string="项目名称" name="name" context="{'group_by': 'name'}"/>
                        <filter string="开始日期" name="start_date" context="{'group_by': 'start_date'}"/>
                        <filter string="截止日期" name="end_date" context="{'group_by': 'end_date'}"/>
                    </group>
                </search>
            </field>
        </record>
        <!--培训项目-课程明细-->
        <record id="act_staff_program_2_staff_course_all" model="ir.actions.act_window">
            <field name="name">课程</field>
            <field name="res_model">staff.course</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('project_id', '=', active_id)]</field>
            <field name="context">{
                'pivot_row_groupby': ['user_id'],
                'default_project_id': active_id,
            }</field>
            <field name="search_view_id" ref=""/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    找不到课程。让我们创建一个！
                </p>
            </field>
        </record>
        <!--培训项目form-->
        <record id='staff_program_form' model='ir.ui.view'>
            <field name='name'>staff.program.form</field>
            <field name='model'>staff.program</field>
            <field name='arch' type='xml'>
                <form string='培训项目'>
                    <field name="active" invisible="1"/>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" type="action"
                                        name="%(act_staff_program_2_staff_course_all)d" icon="fa-tasks">
                                <field string="附加课程数" name="task_count" widget="statinfo"/>
                            </button>
                        </div>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="项目名称"/>
                            </h1>
                            <div name="options_active">
                                <div>
                                    <field name="label_tasks" class="oe_inline oe_input_align"/>
                                </div>
                            </div>
                        </div>
                        <group>
                            <group>
                                <field name="user_id" string="项目主管" widget="many2one_avatar_user"
                                       attrs="{'readonly':[('active','=',False)]}" domain="[('share', '=', False)]"/>
                                <field name="start_date"/>
                                <field name="end_date"/>
                            </group>
                            <group>
                                <field name="train_Location"/>
                                <field name="train_amount"/>
                                <field name="trainees"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="description_page" string="项目描述">
                                <field name="description" nolabel="1" placeholder="项目描述…" type="html"/>
                                <div class="oe_clear"/>
                            </page>
                            <page name="train_person_page" string="参训学员">
                                <group span="4">
                                    <field name="train_person_ids" placeholder="选择参训学员"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"
                               options="{'post_refresh':True}" help="跟踪此项目可自动跟踪与此项目的任务和问题关联的事件。"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <!--培训项目kanban-->
        <record model="ir.ui.view" id="view_staff_program_kanban">
            <field name="name">staff.program.kanban</field>
            <field name="model">staff.program</field>
            <field name="arch" type="xml">
                <kanban class="oe_background_grey o_kanban_dashboard o_project_kanban o_emphasize_colors" sample="1">
                    <field name="name"/>
                    <field name="color"/>
                    <field name="user_id"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="task_count"/>
                    <field name="label_tasks"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click o_has_icon">
                                <div class="o_project_kanban_main">
                                    <div class="o_kanban_card_content">
                                        <div class="o_kanban_primary_left">
                                            <div class="o_primary">
                                                <span><t t-esc="record.name.value"/></span>
                                                <span class="o_label">期间:</span>
                                                <span class="o_value">
                                                    <t t-esc="record.start_date.value"/>
                                                </span>
                                                <span t-if="record.end_date.value">
                                                    -
                                                </span>
                                                <span class="o_value">
                                                    <t t-esc="record.end_date.value"/>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="o_kanban_card_manage_pane dropdown-menu" role="menu">
                                        <div class="o_kanban_card_manage_section o_kanban_manage_reports">
                                            <div role="menuitem">
                                                <a type="edit">编辑</a>
                                            </div>
                                        </div>
                                        <div role="menuitem" aria-haspopup="true" class="o_no_padding_kanban_colorpicker">
                                            <ul class="oe_kanban_colorpicker" data-field="color" role="popup"/>
                                        </div>
                                    </div>
                                    <a class="o_kanban_manage_toggle_button o_left" href="#"><i class="fa fa-ellipsis-v" role="img" aria-label="管理" title="管理"/></a>

                                    <div class="o_project_kanban_boxes">
                                        <a class="o_project_kanban_box" name="action_view_tasks" type="object">
                                            <div>
                                                <span class="o_value"><t t-esc="record.task_count.value"/></span>
                                                <span class="o_label"><t t-esc="record.label_tasks.value"/></span>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="o_project_kanban_boxes">
                                        <div class="o_project_kanban_box">
                                            <span class="o_label">项目主管:</span>
                                            <span class="o_value" t-if="record.user_id.value">
                                                <t t-esc="record.user_id.value"/>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <!--培训项目action-->
        <record id="open_view_staff_program_all_config" model="ir.actions.act_window">
            <field name="name">培训项目</field>
            <field name="res_model">staff.program</field>
            <field name="domain">[]</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_staff_program_kanban')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('staff_program_tree')})]"/>
            <field name="search_view_id" ref="view_staff_program_filter"/>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                   找不到项目。让我们创建一个！
                </p><p>
                    项目重新组合同一主题上的任务，每个项目都有自己的仪表板。
                </p>
            </field>
        </record>
        <menuitem action="open_view_staff_program_all_config" id="menu_staff_programs_config" name="培训项目" parent="menu_staff_train" sequence="1"/>

        <!--培训课程tree-->
        <record id='staff_course_tree' model='ir.ui.view'>
            <field name='name'>staff.course.tree</field>
            <field name='model'>staff.course</field>
            <field name='arch' type='xml'>
                <tree decoration-muted="active == False" string="培训课程" delete="0" multi_edit="1" sample="1">
                    <field name='project_id'/>
                    <field name="sequence"/>
                    <field name='name'/>
                    <field name="course_teacher_id"/>
                    <field name='priority'/>
                    <field name='state'/>
                    <field name='start_date'/>
                    <field name='end_date'/>
                    <field name='planned_hours'/>
                    <field name='manager_id'/>
                    <field name='tag_ids' optional="hide"/>
                    <field name='active' invisible="1"/>
                </tree>
            </field>
        </record>
        <!--培训项目filter-->
        <record id="view_staff_course_filter" model="ir.ui.view">
            <field name="name">staff.course.select</field>
            <field name="model">staff.course</field>
            <field name="arch" type="xml">
                <search string="Search Course">
                    <field name="name" string="课程名称"/>
                    <field name="project_id" string="培训项目"/>
                    <field name="manager_id" string="课程主管"/>
                    <field name="course_teacher_id" string="课程讲师"/>
                    <separator/>
                    <filter string="已归档" name="inactive" domain="[('active', '=', False)]"/>
                    <group expand="0" string="Group By">
                        <filter string="课程主管" name="Manager" context="{'group_by': 'manager_id'}"/>
                        <filter string="培训项目" name="project_id" context="{'group_by': 'project_id'}"/>
                        <filter string="优先级" name="priority" context="{'group_by': 'priority'}"/>
                        <filter string="课程阶段" name="name" context="{'group_by': 'state'}"/>
                        <filter string="课程开始日期" name="start_date" context="{'group_by': 'start_date'}"/>
                        <filter string="课程结束日期" name="end_date" context="{'group_by': 'end_date'}"/>
                    </group>
                </search>
            </field>
        </record>
        <!--培训项目form-->
        <record id='staff_course_form' model='ir.ui.view'>
            <field name='name'>staff.course.form</field>
            <field name='model'>staff.course</field>
            <field name='arch' type='xml'>
                <form string='培训课程'>
                    <field name="active" invisible="1"/>
                    <sheet>
                        <widget name="web_ribbon" title="已归档" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="课程名称" attrs="{'readonly': [('state', '=', 'done')]}"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="course_teacher_id" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="priority" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="start_date" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="end_date" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="planned_hours" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="sequence" attrs="{'readonly': [('state', '=', 'done')]}"/>
                            </group>
                            <group>
                                <field name="state" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="project_id" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="manager_id" attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <field name="tag_ids" widget="many2many_tags" placeholder="课程标签"
                                       attrs="{'readonly': [('state', '=', 'done')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="description_page" string="课程描述">
                                <field name="description" nolabel="1" placeholder="课程描述…" type="html"
                                       attrs="{'readonly': [('state', '=', 'done')]}"/>
                                <div class="oe_clear"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" options="{'post_refresh':True}"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <!--培训项目action-->
        <record id="action_staff_course" model="ir.actions.act_window">
            <field name="name">培训课程</field>
            <field name="res_model">staff.course</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('staff_course_tree')})]"/>
            <field name="search_view_id" ref="view_staff_course_filter"/>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                   找不到课程。让我们创建一个！
                </p>
            </field>
        </record>
        <!-- 基础设置 -->
        <menuitem id="sub_menu_staff_course" name='培训课程' action="action_staff_course" parent="menu_staff_train" sequence="10"/>
	</data>
</odoo>
