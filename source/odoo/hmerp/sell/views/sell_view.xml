<?xml version="1.0"?>
<openerp>
    <data>
    	<!--销售订单tree视图-->
    	<record id='sell_order_tree' model='ir.ui.view'>
        	<field name='name'>sell.order.tree</field>
        	<field name='model'>sell.order</field>
        	<field name='arch' type='xml'>
                <tree string='销售订单' decoration-info='state == "draft"' decoration-muted='state == "cancel"' decoration-danger='paid_no_goods'>
            		<field name='date' optional="show"/>
            		<field name='name' optional="show"/>
            		<field name='type' optional="hide"/>
            		<field name='user_id' optional="show"/>
            		<field name='partner_id' options="{'no_open': True, 'no_create': True}" optional="show"/>
            		<field name='details' widget="html" optional="show"/>
					<field name="amount" sum="合计" optional="show"/>
            		<field name='delivery_date' optional="hide"/>
                    <field name='state' optional="show"/>
            		<field name='goods_state' optional="show"/>
					<field name="received_amount" optional="hide"/>
					<field name='currency_id'
						   groups='finance.group_multi_currency' optional="show"/>
					<field name="ref" optional="show"/>
					<field name="paid_no_goods" invisible="1"/>
            	</tree>
        	</field>
    	</record>

    	<!--销售订单form视图-->
    	<record id='sell_order_form' model='ir.ui.view'>
        	<field name='name'>sell.order.form</field>
        	<field name='model'>sell.order</field>
        	<field name='arch' type='xml'> 
            	<form string='销售订单'>
            		<header>
            			<button name='sell_order_done' states='draft' string='确认' type='object' class='oe_highlight'/>
            			<button name="sell_order_draft" states="done" string="撤销" type="object"/>
                        <button name="action_cancel" states="draft" string="作废" type="object"/>
						<field name='state' widget='statusbar' statusbar_visible="draft,done"/>
            		</header>
            		<sheet>
						<div class="oe_button_box" name="button_box">
							<button type="object"
								name="action_view_delivery"
								class="oe_stat_button"
								icon="fa-truck" attrs="{'invisible':['|', ('state', 'in', ('draft')),('delivery_count','=',0)]}">
								<field name="delivery_count" widget="statinfo" string="发货单" help="Incoming Shipments"/>
								<field name="delivery_ids" invisible="1"/>
							</button>
							<button type="object"
								name="action_view_return"
								class="oe_stat_button"
								icon="fa-truck" attrs="{'invisible':['|', ('state', 'in', ('draft')),('return_count','=',0)]}">
								<field name="return_count" widget="statinfo" string="退货单" help="Incoming Shipments"/>
								<field name="delivery_ids" invisible="1"/>
							</button>
							<button type="object"
								name="action_view_invoice"
								class="oe_stat_button"
								icon="fa-pencil-square-o" attrs="{'invisible':['|', ('state', 'in', ('draft')),('invoice_count','=',0)]}">
								<field name="invoice_count" widget="statinfo" string="结算单"/>
								<field name="invoice_ids" invisible="1"/>
							</button>
						</div>

            			<group>
            				<group>
            					<field name='partner_id' required='1'
            						domain="[('c_category_id', '!=', False)]"
						        options="{'no_open': True, 'no_create': True}"
            						context="{'tree_view_ref': 'core.customer_tree'}"/>
            					<field name='contact'/>
            				    <field name='address_id'
            				        options="{'no_open': True, 'no_create': True}"/>
            				    <field name='mobile'/>
            					<field name='user_id' readonly="1"
                                       options="{'no_open': True, 'no_create': True}"/>
            					<field name='date'/>
            					<field name='warehouse_id'/>
								<field name='term_id'/>
								<field name='pol'/>
								<field name='pod'/>
            				</group>
            				<group>
							    <field name="ref"/>
            					<field name='delivery_date'/>
            					<field name='type' widget='radio'/>
            					<field name='goods_state' readonly='1'/>
								<field name='currency_id' readonly='1'
									 groups='finance.group_multi_currency'/>
								<field name='pay_base_currency'
									 groups='finance.group_multi_currency'/>
							    <field name='pay_method' options="{'no_open': True, 'no_create': True}"/>
								<field name="express_type"/>
							</group>
            			</group>
            			<notebook>
            				<page name="lines" string="销售订单行">
            					<field name='line_ids'>
                 					<tree string='销售订单行' editable='bottom'>
                 						<field name='goods_id' domain="[('not_saleable','=',False)]" optional="show"/>
                 						<field name='attribute_id'
                 							groups='goods.multi_attrs_groups'
                 							attrs="{'required': [('using_attribute','=', True)], 'readonly': [('using_attribute','!=', True)]}" optional="show"/>
                 						<field name='quantity' sum='数量合计' optional="show"/>
                 						<field name="quantity_out" readonly="1" sum="合计已发货数量" optional="show"/>
                 						<field name='uom_id' optional="show"/>
                 						<field name='price' optional="show"/>
				 						<field name="price_taxed" groups='sell.out_tax_groups' optional="show"/>
										<field name='discount_rate' groups='sell.sell_line_discount_groups' optional="show"/>
										<field name='discount_amount' sum='折扣额合计' groups='sell.sell_line_discount_groups' optional="show"/>
										<field name='amount' sum='金额合计' optional="show"/>
				 						<field name='tax_rate' groups='sell.out_tax_groups' optional="show"/>
                 						<field name='tax_amount' sum='税额合计' groups='sell.out_tax_groups' optional="show"/>
				 						<field name='subtotal' sum='价税合计' groups='sell.out_tax_groups' optional="show"/>
				 						<field name='note' optional="show"/>
				 						<field name='using_attribute' invisible='1' optional="show"/>
				 					</tree>
				 				</field>
				 				<field name="note" placeholder="暂无备注信息"/>
				 				<group>
                        			<group>
										<field name="discount_amount" groups='sell.sell_discount_groups'/>
                            			<field name="amount"/>
										<field name="received_amount"/>
										<field name="net_weight"/>
                        			</group>
                        			<group>
										<field name="pre_receipt"/>
                            			<field name="bank_account_id"/>
                            			<field name="money_order_id"/>
                        			</group>
                    			</group>
                    			<group>
                        			<group>
                            			<field name="create_uid" readonly="1" string="制单人"/>
                            			<field name="approve_uid" readonly="1"/>
                            		</group>
                        			<group>
                            			<field name="create_date" readonly="1" string="录单时间"/>
                            			<field name="write_date" readonly="1" string="最后修改时间"/>
                        			</group>
                    			</group>
				 			</page>
				 		</notebook>
            		</sheet>
                	<div class="oe_chatter">
                    	<field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
						
                    	<field name="message_ids" widget="mail_thread"/>
                	</div>
            	</form>
        	</field>
    	</record>

    	<record id="sell_order_search" model="ir.ui.view">
            <field name="name">sell.order.search</field>
            <field name="model">sell.order</field>
            <field name="arch" type="xml">
                <search string="销售订单">
				    <field name="ref"/>
                    <field name="name"/>
                    <field name="type"/>
                    <field name="partner_id"/>
					<!--TODO:按产品搜索订单，明细就不显示了-->
					<field name="goods_id"/>
                    <field name="state"/>
                    <field name="goods_state"/>
                    <field name="create_uid" string="制单人"/>
                    <field name="approve_uid"/>
                    <filter name="draft" string="草稿" domain="[('state','=','draft')]"/>
                    <filter name="done" string="已确认" domain="[('state','=','done')]"/>
					<filter name="user_id" string="我的订单" domain="[('user_id','=',uid)]"/>
                    <separator/>
                    <filter name="not out" string="未出库" domain="[('goods_state','=',u'未出库')]"/>
                    <filter name="part out" string="部分出库" domain="[('goods_state','=',u'部分出库')]"/>
                    <filter name="all out" string="全部出库" domain="[('goods_state','=',u'全部出库')]"/>
                    <separator/>
                    <filter name="sell" string="销售" domain="[('type','=','sell')]"/>
                    <filter name="return" string="退货" domain="[('type','=','return')]"/>
                    <group expand="0" string="分组">
                        <filter name='by_partner' string="客户" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter name='by_date' string="单据日期" domain="[]" context="{'group_by':'date:day'}"/>
                        <filter name='by_ddate' string="要求交货日期" domain="[]" context="{'group_by':'delivery_date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

    	<!--销售订单发货单tree视图-->
    	<record id='sell_delivery_tree' model='ir.ui.view'>
        	<field name='name'>sell.delivery.tree</field>
        	<field name='model'>sell.delivery</field>
        	<field name='arch' type='xml'>
                <tree string='销售发货单' decoration-info='state == "draft"' decoration-muted= 'state == "cancel"' >
            		<field name='date' optional="show"/>
            		<field name='name' optional="show"/>
                    <field name="order_id" groups='sell.sell_groups' optional="show"/>
            		<field name='user_id' string="销售员" optional="show"/>
                    <field name='warehouse_id' optional="show"/>
            		<field name='partner_id' options="{'no_open': True, 'no_create': True}" optional="show"/>
					<field name='details' widget="html" optional="show"/>
					<field name='total_qty' optional="hide"/>
            		<field name="amount" sum="总金额" groups='sell.group_sell' optional="hide"/>
					<field name='currency_id'
						   groups='finance.group_multi_currency' optional="show"/>
                    <field name='state' optional="show"/>
					
            		<field name='money_state' groups='sell.group_sell' optional="show"/>
            	</tree>
        	</field>
    	</record>

    	<!--销售发货单form视图-->
    	<record id='sell_delivery_form' model='ir.ui.view'>
        	<field name='name'>sell.delivery.form</field>
        	<field name='model'>sell.delivery</field>
        	<field name='arch' type='xml'>
            	<form string='销售发货单'>
            		<header>
					    <button string="设为今天" name="set_today" type="object" states="draft"/>
						<button name='sell_to_return' type='object' states="done" string='生成退货单' class="oe_highlight"/>
            			<button name='sell_delivery_done' states='draft'
						        groups='warehouse.group_warehouse'
								type='object' string='发货' class='oe_highlight'/>
						<button name='sell_delivery_draft' states='done'
						        groups='warehouse.group_warehouse'
								type='object' string='撤销'/>
                        <button name="action_cancel" states="draft" string="作废" groups='sell.group_sell' type="object"/>
						<field name='state' widget='statusbar' statusbar_visible="draft,done"/>
            		</header>
            		<sheet>
					    <field name="_barcode_scanned" widget="barcode_handler"/>
            			<group>
            				<group>
            					<field name='partner_id' required='1'
            						attrs="{'readonly': [('state','!=','draft')]}"
						        	options="{'no_create': True}"
            						domain="[('c_category_id', '!=', False)]"
            						context="{'form_view_ref': 'core.customer_address_form'}"/>
            				    <field name='contact'/>
            				    <field name="address_id" options="{'no_open': True, 'no_create': True}"/>
            				    <field name="mobile"/>
            					<field name='user_id'
                                       options="{'no_open': True, 'no_create': True}"/>
            					<field name='date' string="出库日期" attrs="{'readonly': [('state','!=','draft')]}"/>
            					<field name="warehouse_id"/>
								<field name="warehouse_dest_id" invisible="1"/>
								<field name="is_return" invisible="1"/>
            				</group>
            				<group>
							    <field name="ref"/>
            					<field name='date_due' required='1' attrs="{'readonly': [('state','!=','draft')]}"/>
                                <field name='order_id' readonly='1' groups='sell.sell_groups'/>
								<field name='finance_category_id' invisible="1"/>
                                <field name='invoice_id' readonly='1' groups='base.group_no_one'/>
                                <field name='voucher_id' readonly='1' groups='base.group_no_one'/>
                                <field name="money_state" readonly="1" groups='base.group_no_one'/>
								<field name="currency_id" readonly="1"
									 groups='finance.group_multi_currency'/>
								<field name="express_type"/>
								<field name="express_code"/>
            				</group>
            			</group>
            			<notebook>
                    		<page name="lines" string="发货单行">
		    					<field name='line_out_ids' attrs="{'readonly': [('state','!=','draft')]}"
		    						context="{
		    						'type':'out',
		         					'default_date':date,
		         					'default_partner':partner_id,
		         					'default_warehouse_id': warehouse_id,
		         					'default_is_return': is_return,
		    						}">
		         					<tree string='销售发货单行' editable='bottom'>
		         						<field name='goods_id'
										    domain="[('not_saleable','=',False)]"
		         							context="{'default_partner':parent.partner_id,
											          'order_id':parent.order_id,
		         									  'default_is_return':parent.is_return,
		         									  }" optional="show"/>
		         						<field name='attribute_id'
		         							domain="[('goods_id', '=', goods_id)]"
		         							groups='goods.multi_attrs_groups'
		         							attrs="{'required': [('using_attribute','=', True)], 'readonly': [('using_attribute','!=', True)]}" optional="show"/>
	                    				<field name="warehouse_id" invisible="1"/>
										<field name='lot_id' attrs="{'readonly': [('using_batch', '=', False)], 'required': [('using_batch', '=', True)]}"
	                       					context="{'lot': True}" options="{'no_open': True, 'no_create': True}"
	                    					groups='goods.batch_groups' optional="show"/>
										<field name="location_id"
											   options="{'no_open':True,'no_create':True}"
											   groups="warehouse.multi_location_groups"
											   domain="[('warehouse_id','=',parent.warehouse_id),('goods_id','=',goods_id)]" optional="show"/>
		         						<field name='goods_uos_qty' sum='辅助数量合计'
		         							groups='goods.auxiliary_unit_groups' optional="show"/>
				 						<field name='uos_id' groups='goods.auxiliary_unit_groups'  optional="show"/>
				 						<field name='goods_qty' sum='数量合计' optional="show"/>
		         						<field name='uom_id' optional="show"/>
		         						<field name='price' groups='sell.group_sell' optional="show"/>
				 						<field name="price_taxed" groups='sell.out_tax_groups' optional="show"/>
										<field name='discount_rate' groups='sell.sell_line_discount_groups' optional="show"/>
										<field name='discount_amount' sum='折扣额合计' groups='sell.sell_line_discount_groups' optional="show"/>
				 						<field name='amount' string='销售金额' sum='金额合计' groups='sell.group_sell' optional="show"/>
				 						<field name='tax_rate' groups='sell.out_tax_groups' optional="show"/>
		         						<field name='tax_amount' sum='税额合计' groups='sell.out_tax_groups' optional="show"/>
				 						<field name='subtotal' sum='价税合计' groups='sell.out_tax_groups' optional="show"/>
										<field name='expiration_date'
                                           readonly='1'
                                           groups='warehouse.group_expiration_date'  optional="show"/>
				 						<field name='line_net_weight' sum="净重合计" groups="warehouse.manager_net_weight_group" optional="show"/>
				 						<field name='note' optional="show"/>
				 						<field name="type" invisible="1" optional="show"/>
				 						<field name='using_attribute' invisible='1' optional="show"/>
				 						<field name='using_batch' invisible='1' optional="show"/>
			                            <field name='lot_qty' invisible='1' optional="show"/>
			                            <field name='lot' invisible='1' optional="show"/>
										<field name='sell_line_id' invisible='1' optional="show"/>
										<field name="all_lack" optional="hide"/>
                                        <field name="wh_lack" optional="hide"/>
										<field name="state" invisible="1"/>
				 					</tree>
				 				</field>
			 				</page>
			                <page name="fees" string="销售费用行">
			                	<field name="cost_line_ids" attrs="{'readonly': [('state','!=','draft')]}">
			                		<tree string="Cost Lines" editable="bottom">
			                			<field name="partner_id"
			                				domain="[('s_category_id', '!=', False)]"
			                				context="{'form_view_ref': 'core.supplier_address_form'}" optional="show"/>
				                		<field name="category_id" optional="show"/>
				                		<field name="amount" optional="show"/>
				                		<field name='tax_rate' groups="sell.out_tax_groups" optional="show"/>
				                		<field name="tax" groups="sell.out_tax_groups" optional="show"/>
				                		<field name="note" optional="show"/>
				                	</tree>
			                	</field>
			                </page>
			            </notebook>
		 				<group>
                			<group>
								<field name="discount_amount" string="抹零" groups='sell.sell_discount_groups'/>
                    			<field name="amount" groups='sell.group_sell'/>
                    			<field name="partner_cost" attrs="{'readonly': [('state','!=','draft')]}"/>
                			</group>
                			<group>
                				<field name="receipt" attrs="{'readonly': [('state','!=','draft')]}" groups='sell.group_sell'/>
                				<field name="bank_account_id" attrs="{'readonly': [('state','!=','draft')]}" groups='sell.group_sell'/>
                				<field name="money_order_id" groups='sell.group_sell'/>
                			</group>
            			</group>
						<field name="note" placeholder="暂无备注信息" attrs="{'readonly': [('state','!=','draft')]}"/>
						<group>
                            <field name='qc_result' widget='pdf_viewer'
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
								   groups='warehouse.group_qc'
							/>
                        </group>
		 				<group>
						    <group>
                    			<field name="create_uid" readonly="1" string="制单人"/>
                    			<field name="approve_uid" readonly="1"/>
                			</group>
                			<group>
                				<field name="create_date" readonly="1" string="录单时间"/>
                				<field name="write_date" readonly="1" string="最后修改时间"/>
                			</group>
					    </group>
            		</sheet>
	                <div class="oe_chatter">
	                    <field name="message_follower_ids" widget="mail_followers"/>
			    <field name="activity_ids" widget="mail_activity" />
	                    <field name="message_ids" widget="mail_thread"/>
	                </div>
            	</form>
        	</field>
    	</record>

		<record id="sell_delivery_search" model="ir.ui.view">
            <field name="name">sell.delivery.search</field>
            <field name="model">sell.delivery</field>
            <field name="arch" type="xml">
                <search string="销售发货单">
                    <field name="name"/>
                    <field name="order_id" groups='sell.sell_groups'/>
                    <field name="partner_id"/>
					<field name='out_goods_id'/>
                    <field name="state"/>
                    <field name="money_state"/>
                    <field name="create_uid" string="制单人"/>
                    <field name="approve_uid"/>
                    <field name="warehouse_id"/>
                    <filter name="draft" string="草稿" domain="[('state','=','draft')]"/>
                    <filter name="done" string="已完成" domain="[('state','=','done')]"/>
                    <separator/>
					<filter string="今日" name="today" domain="[('date','=', current_date)]"/>
					<separator/>
                    <filter name="not paid" string="未收款" domain="[('money_state','=',u'未收款')]"/>
                    <filter name="part paid" string="部分收款" domain="[('money_state','=',u'部分收款')]"/>
                    <filter name="all paid" string="全部收款" domain="[('money_state','=',u'全部收款')]"/>
                    <group expand="0" string="分组">
                        <filter name='by_partner' string="客户" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter name='by_date' string="单据日期" domain="[]" context="{'group_by':'date:day'}"/>
                        <filter name='by_date_due' string="到期日" domain="[]" context="{'group_by':'date_due:day'}"/>
                        <filter name='by_wh' string="调出仓库" domain="[]" context="{'group_by':'warehouse_id'}"/>
                    </group>
                </search>
            </field>
        </record>
		<record id="sell_delivery_calendar" model="ir.ui.view">
            <field name="name">sell.delivery.calendar</field>
            <field name="model">sell.delivery</field>
            <field name="arch" type="xml">
                <calendar color="partner_id" date_start="date_due" quick_add="False" string="销售发货单">
                    <field name="name"/>
					<field name="partner_id"/>
                </calendar>
            </field>
        </record>

    	<!--销售退货单tree视图-->
    	<record id='sell_return_tree' model='ir.ui.view'>
        	<field name='name'>sell.return.tree</field>
        	<field name='model'>sell.delivery</field>
        	<field name='arch' type='xml'>
                <tree string='销售退货单' decoration-info='state == "draft"' decoration-muted= 'state == "cancel"' >
            		<field name='date' optional="show"/>
            		<field name='name' optional="show"/>
                    <field name="order_id" groups='sell.sell_groups' optional="show"/>
            		<field name='user_id' optional="show"/>
                    <field name='warehouse_dest_id' optional="show"/>
					<field name='details' widget="html" optional="show"/>
            		<field name='partner_id' options="{'no_open': True, 'no_create': True}" optional="show"/>
					<field name='total_qty' optional="show"/>
            		<field name="amount" sum="总金额" groups='sell.group_sell' optional="show"/>
            		<field name='receipt' string="本次退款" optional="show"/>
            		<field name='date_due' optional="show"/>
					<field name='currency_id'
						   groups='finance.group_multi_currency' optional="show"/>
                    <field name='state' optional="show"/>
					
            		<field name='return_state' optional="show"/>
            	</tree>
        	</field>
    	</record>

    	<!--销售退货单form视图-->
    	<record id='sell_return_form' model='ir.ui.view'>
        	<field name='name'>sell.return.form</field>
        	<field name='model'>sell.delivery</field>
        	<field name='arch' type='xml'>
            	<form string='销售退货单'>
            		<header>
            			<button name='sell_delivery_done' states="draft"
						        groups='warehouse.group_warehouse'
								type='object' string='入库' class='oe_highlight'/>
						<button name='sell_delivery_draft' states='done'
						        groups='warehouse.group_warehouse'
								type='object' string='撤销'/>
                        <button name="action_cancel" states="draft" string="作废" groups='sell.group_sell' type="object"/>
						<field name='state' widget='statusbar' statusbar_visible="draft,done"/>
            		</header>
            		<sheet>
            			<group>
            				<group>
            					<field name='partner_id' required='1'
            						attrs="{'readonly': [('state','!=','draft')]}"
						        options="{'no_open': True, 'no_create': True}"
            						domain="[('c_category_id', '!=', False)]"
            						context="{'form_view_ref': 'core.customer_address_form'}"/>
            					<field name='contact'/>
            				    <field name="address_id" options="{'no_open': True, 'no_create': True}"/>
            				    <field name="mobile"/>
            					<field name='user_id'
                                       options="{'no_open': True, 'no_create': True}"/>
            					<field name='date' attrs="{'readonly': [('state','!=','draft')]}"/>
            					<field name="warehouse_dest_id"/>
								<field name="warehouse_id" invisible="1"/>
								<field name="is_return" invisible="1"/>
            				</group>
            				<group>
            					<field name='date_due' required='1' attrs="{'readonly': [('state','!=','draft')]}"/>
                                <field name='order_id' readonly='1' groups='sell.sell_groups'/>
								<field name='finance_category_id' invisible="1"/>
            					<field name='invoice_id' readonly='1'/>
								<field name='voucher_id' readonly='1'/>
            					<field name="return_state" readonly="1"/>
								<field name='currency_id' readonly='1'
									   groups='finance.group_multi_currency'/>
            				</group>
            			</group>
            			<notebook>
                    		<page name="lines" string="退货单行">
		    					<field name='line_in_ids' attrs="{'readonly': [('state','!=','draft')]}"
		    						context="{
		    						'type':'in',
                                    'default_is_return': is_return,
		    						}">
		         					<tree string='销售退货单行' editable='bottom'>
		         						<field name='goods_id'
										    domain="[('not_saleable','=',False)]"
		         							context="{'default_partner':parent.partner_id,
											          'order_id':parent.order_id,
		         									  'default_is_return':parent.is_return}" optional="show"/>
		         						<field name='attribute_id'
		         							domain="[('goods_id', '=', goods_id)]"
		         							groups='goods.multi_attrs_groups'
		         							attrs="{'required': [('using_attribute','=', True)], 'readonly': [('using_attribute','!=', True)]}" optional="show"/>
					                    <field name='lot' groups='goods.batch_groups'
					                    	attrs="{'readonly': [('using_batch', '=', False)], 'required': [('using_batch', '=', True)]}" optional="show"/>
										<field name='location_id' groups="warehouse.multi_location_groups" options="{'no_open': True, 'no_create': True}" optional="show"/>
		         						<field name='goods_uos_qty' sum='辅助数量合计'
		         							groups='goods.auxiliary_unit_groups' optional="show"/>
				 						<field name='uos_id' groups='goods.auxiliary_unit_groups'  optional="show"/>
				 						<field name='goods_qty' sum='数量合计' optional="show"/>
				 						<field name='uom_id' optional="show"/>
				 						<field name='price' groups='goods.view_cost_groups' optional="show"/>
				 						<field name="price_taxed" groups='sell.out_tax_groups,goods.view_cost_groups' optional="show"/>
				 						<field name='cost_unit' groups='goods.view_cost_groups' optional="show"/>
										<field name='discount_rate' groups='sell.sell_line_discount_groups' optional="show"/>
										<field name='discount_amount' sum='折扣额合计' groups='sell.sell_line_discount_groups' optional="show"/>
				 						<field name='amount' string='销售金额' sum='金额合计' groups='goods.view_cost_groups' optional="show"/>
				 						<field name='tax_rate' groups='sell.out_tax_groups' optional="show"/>
		         						<field name='tax_amount' sum='税额合计' groups='sell.out_tax_groups' optional="show"/>
				 						<field name='subtotal' sum='价税合计' groups='sell.out_tax_groups' optional="show"/>
										<field name='expiration_date' groups='warehouse.group_expiration_date'  optional="show"/>
				 						<field name='line_net_weight' sum="净重合计" groups="warehouse.manager_net_weight_group" optional="show"/>
				 						<field name='note' optional="show"/>
				 						<field name="type" invisible="1" optional="show"/>
				 						<field name='using_attribute' invisible='1' optional="show"/>
				 						<field name='using_batch' invisible='1' optional="show"/>
					                    <field name='force_batch_one' invisible='1' optional="show"/>
										<field name='sell_line_id' invisible='1' optional="show"/>
										<field name="state" invisible="1"/>
				 					</tree>
				 				</field>
			 				</page>
			                <page name="fees" string="销售费用行">
			                	<field name="cost_line_ids" attrs="{'readonly': [('state','!=','draft')]}">
			                		<tree string="Cost Lines" editable="bottom">
			                			<field name="partner_id" domain="[('s_category_id', '!=', False)]" optional="show"/>
				                		<field name="category_id" domain="[('type', '=', 'income')]" optional="show"/>
				                		<field name="amount" optional="show"/>
                                        <field name="tax_rate" groups="sell.out_tax_groups" optional="show"/>
                                        <field name="tax" groups="sell.out_tax_groups" optional="show"/>
				                		<field name="note" optional="show"/>
				                	</tree>
			                	</field>
			                </page>
			            </notebook>
		 				<field name="note" placeholder="暂无备注信息" attrs="{'readonly': [('state','!=','draft')]}"/>
						<group>
                            <field name='qc_result' widget='pdf_viewer'
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
								   groups='warehouse.group_qc'
							/>
                        </group>
		 				<group>
                			<group>
								<field name="discount_amount" groups='sell.sell_discount_groups'/>
                    			<field name="amount" groups='sell.group_sell'/>
                    			<field name="partner_cost" attrs="{'readonly': [('state','!=','draft')]}"/>
                    			<field name="create_uid" readonly="1" string="制单人"/>
                    			<field name="approve_uid" readonly="1"/>
                			</group>
                			<group>
                				<field name="receipt" attrs="{'readonly': [('state','!=','draft')]}" groups='sell.group_sell'/>
                				<field name="bank_account_id" attrs="{'readonly': [('state','!=','draft')]}" groups='sell.group_sell'/>
                				<field name="money_order_id" groups='sell.group_sell'/>
                				<field name="create_date" readonly="1" string="录单时间"/>
                				<field name="write_date" readonly="1" string="最后修改时间"/>
                			</group>
            			</group>
            		</sheet>
	                <div class="oe_chatter">
	                    <field name="message_follower_ids" widget="mail_followers"/>
						
	                    <field name="message_ids" widget="mail_thread"/>
	                </div>
            	</form>
        	</field>
    	</record>

		<record id="sell_return_search" model="ir.ui.view">
            <field name="name">sell.return.search</field>
            <field name="model">sell.delivery</field>
            <field name="arch" type="xml">
                <search string="销售退货单">
                    <field name="name"/>
                    <field name="order_id" groups='sell.sell_groups'/>
                    <field name="partner_id"/>
					<field name='in_goods_id'/>
                    <field name="state"/>
                    <field name="return_state"/>
                    <field name="create_uid" string="制单人"/>
                    <field name="approve_uid"/>
                    <filter name="draft" string="草稿" domain="[('state','=','draft')]"/>
                    <filter name="done" string="已完成" domain="[('state','=','done')]"/>
                    <separator/>
                    <filter name="not refund" string="未退款" domain="[('return_state','=',u'未退款')]"/>
                    <filter name="part refund" string="部分退款" domain="[('return_state','=',u'部分退款')]"/>
                    <filter name="all refund" string="全部退款" domain="[('return_state','=',u'全部退款')]"/>
                    <group expand="0" string="分组">
                        <filter name="by_partner" string="客户" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter name="by_date" string="单据日期" domain="[]" context="{'group_by':'date:day'}"/>
                        <filter name="by_date_due" string="到期日" domain="[]" context="{'group_by':'date_due:day'}"/>
                    </group>
                </search>
            </field>
        </record>

		<!-- 销售变更单视图 -->

    	<record id="sell_adjust_tree" model="ir.ui.view">
            <field name="name">sell.adjust.tree</field>
            <field name="model">sell.adjust</field>
            <field name="arch" type="xml">
                <tree string="销售变更单" decoration-info='state == "draft"' decoration-muted= 'state == "cancel"' >
                    <field name="date" optional="show"/>
                    <field name="name" optional="show"/>
                    <field name="order_id" optional="show"/>
                    <field name="create_uid" string="制单人" optional="show"/>
                    <field name="approve_uid" optional="show"/>
                    <field name="state" optional="show"/>
					
                </tree>
            </field>
        </record>

        <record id="sell_adjust_form" model="ir.ui.view">
            <field name="name">sell.adjust.form</field>
            <field name="model">sell.adjust</field>
            <field name="arch" type="xml">
                <form string="销售变更单">
                <header>
                	<button name="sell_adjust_done" states="draft" string="确认" type="object" class="oe_highlight"/>
                     <button name="action_cancel" states="draft" string="作废" type="object"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,done" statusbar_colors='{"done":"blue"}' readonly="1"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="order_id" required="1"
                            	domain="[('state', '=', 'done'), ('type', '=', 'sell')]"
                            	options="{'no_create': True}"/>
							<field name='user_id'
								   options="{'no_open': True, 'no_create': True}"/>
                        </group>
                        <group>
                        	<field name="date" required="1"/>
                        </group>
                    </group>
                    <field name="line_ids">
                    	<tree string="销售变更单行" editable="bottom">
                            <field name='goods_id' required='1' domain="[('not_saleable','=',False)]" optional="show"/>
                            <field name='attribute_id'
                            	groups='goods.multi_attrs_groups'
                            	attrs="{'required': [('using_attribute','=', True)], 'readonly': [('using_attribute','!=', True)]}" optional="show"/>
                            <field name='quantity' sum='数量合计' optional="show"/>
     						<field name='uom_id' optional="show"/>
     						<field name='price' optional="show"/>
	 						<field name='price_taxed' groups='sell.out_tax_groups' optional="show"/>
							<field name='discount_rate' groups='sell.sell_line_discount_groups' optional="show"/>
							<field name='discount_amount' sum='折扣额合计' groups='sell.sell_line_discount_groups' optional="show"/>
	 						<field name='amount' sum='金额合计' optional="show"/>
	 						<field name='tax_rate' groups='sell.out_tax_groups' optional="show"/>
     						<field name='tax_amount' sum='税额合计' groups='sell.out_tax_groups' optional="show"/>
	 						<field name='subtotal' sum='价税合计' groups='sell.out_tax_groups' optional="show"/>
	 						<field name='note' optional="show"/>
	 						<field name='using_attribute' invisible='1' optional="show"/>
                        </tree>
                    </field>
                    <field name="note" placeholder="暂无备注信息"/>
                    <group>
                        <group>
                            <field name="create_uid" readonly="1" string="制单人"/>
                            <field name="approve_uid" readonly="1"/>
                        </group>
                    	<group>
                            <field name="create_date" readonly="1" string="录单时间"/>
                            <field name="write_date" readonly="1" string="最后修改时间"/>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
					
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>

		<record id="sell_adjust_search" model="ir.ui.view">
            <field name="name">sell.adjust.search</field>
            <field name="model">sell.adjust</field>
            <field name="arch" type="xml">
                <search string="销售变更单">
                    <field name="name"/>
                    <field name="order_id"/>
                    <field name="state"/>
                    <field name="create_uid" string="制单人"/>
                    <field name="approve_uid"/>
                    <filter name="draft" string="草稿" domain="[('state','=','draft')]"/>
                    <filter name="done" string="已确认" domain="[('state','=','done')]"/>
                    <group expand="0" string="分组">
                        <filter name="by_date" string="单据日期" domain="[]" context="{'group_by':'date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

		<record id="sell_order_line_view_search" model="ir.ui.view">
			<field name="name">sell.order.line.view.search</field>
			<field name="model">sell.order.line</field>
			<field name="arch" type="xml">
				<search string="销售订单行">
					<field name="order_id"/>
					<field name="goods_id"/>
				</search>
			</field>
    	</record>

    	<!--销售订单，销售发货单action-->
    	<record id='sell_order_action' model='ir.actions.act_window'>
        	<field name='name'>销售订单</field>
        	<field name='res_model'>sell.order</field>
        	
        	<field name='view_mode'>tree,form</field>
        	<field name='view_id' ref='sell_order_tree'/>
			<field name="context">{'warehouse_type': 'stock','search_default_user_id':1}</field>
        	<field name="help" type="html">
               <p class="oe_view_nocontent_create">
                	 点击创建销售订单
               </p>
             </field>
    	</record>

    	<record id='sell_delivery_action' model='ir.actions.act_window'>
        	<field name='name'>销售发货单</field>
        	<field name='res_model'>sell.delivery</field>
        	
        	<field name='view_mode'>tree,form,calendar</field>
        	<field name="context">{'is_return':False, 'warehouse_dest_type': 'customer','search_default_draft':1}</field>
        	<field name="domain">[('is_return','=',False)]</field>
        	<field name='view_id' ref='sell_delivery_tree'/>
        	<field name="search_view_id" ref="sell_delivery_search"/>
        	<field name="help" type="html">
               <p class="oe_view_nocontent_create">
                	 点击创建销售发货单
               </p>
             </field>
    	</record>

		<record id="sell_return_action" model="ir.actions.act_window">
            <field name="name">销售退货单</field>
            <field name="res_model">sell.delivery</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'is_return':True, 'warehouse_type': 'customer'}</field>
            <field name="domain">[('is_return','=',True)]</field>
            <field name="search_view_id" ref="sell_return_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                点击创建销售退货单
              </p>
            </field>
        </record>

		<record id="sell_return_action_tree" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sell_return_tree"/>
            <field name="act_window_id" ref="sell_return_action"/>
        </record>
        <record id="sell_return_action_form" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sell_return_form"/>
            <field name="act_window_id" ref="sell_return_action"/>
        </record>

		<record id="sell_adjust_action" model="ir.actions.act_window">
            <field name="name">销售变更单</field>
            <field name="res_model">sell.adjust</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="sell_adjust_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                点击创建销售变更单
              </p>
            </field>
        </record>

		<!--定价策略-->
		<record id="pricing_tree" model="ir.ui.view">
			<field name="name">pricing.tree</field>
			<field name="model">pricing</field>
			<field name="arch" type="xml">
				<tree editable="TOP" string="定价策略">
					<field name="name" optional="show"/>
					<field name="warehouse_id" optional="show"/>
					<field name="c_category_id" optional="show"/>
					<field name="goods_category_id" optional="show"/>
					<field name='goods_id' optional="show"/>
					<field name="active_date" required='1' optional="show"/>
					<field name="deactive_date" required='1' optional="show"/>
					<field name="discount_rate" optional="show"/>
				</tree>
			</field>
		</record>
		<record id="pricing_search" model="ir.ui.view">
            <field name="name">pricing.search</field>
            <field name="model">pricing</field>
            <field name="arch" type="xml">
                <search string="定价策略">
                    <field name="name"/>
                    <field name="warehouse_id"/>
                    <field name="c_category_id"/>
                    <field name="goods_category_id"/>
                    <field name="goods_id"/>
                    <field name="active_date"/>
                    <field name="deactive_date"/>
                    <field name="discount_rate"/>
                    <group expand="0" string="分组">
                        <filter name="by_wh" string="仓库" domain="[]" context="{'group_by':'warehouse_id'}"/>
                        <filter name="by_pcate" string="客户类别" domain="[]" context="{'group_by':'c_category_id'}"/>
                        <filter name="by_gcate" string="商品类别" domain="[]" context="{'group_by':'goods_category_id'}"/>
                        <filter name="by_goods" string="商品" domain="[]" context="{'group_by':'goods_id'}"/>
                    </group>
                </search>
            </field>
        </record>
		<record id="action_pricing" model="ir.actions.act_window">
			<field name="name">定价策略</field>
			<field name="res_model">pricing</field>
			<field name="type">ir.actions.act_window</field>
			
			<field name="view_mode">tree</field>
			<field name="search_view_id" ref="pricing_search"/>
		</record>

		<record id='goods_action_sell' model='ir.actions.act_window'>
			<field name='name'>商品</field>
			<field name='res_model'>goods</field>
			<field name='view_mode'>tree,form</field>
			<field name='view_id' ref='goods.goods_tree' />
			<field name="domain">[('not_saleable','=',False)]</field>
		</record>

		<record id="money_order_form_add_sell_order" model="ir.ui.view">
            <field name="name">money.order.form</field>
            <field name="model">money.order</field>
            <field name='inherit_id' ref='money.money_order_form'/>
            <field name="arch" type="xml">
                <field name="voucher_id" position="after">
                	<field name="sell_id"
				            	invisible="context.get('default_pay', 0)" 
								domain="[('state','=','done')]"
								attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                </field>
            </field>
        </record>

    	<!--根菜单-->
        <menuitem id='sell_menu' name='销售' groups='sell.group_sell' web_icon="sell,static/description/icon.png" sequence='300'/>
    	<menuitem id='sell_order_menu_root' name='单据' parent='sell_menu' sequence="1"/>
    	<menuitem id='sell_order_menu' name='销售订单' action='sell_order_action'
			parent='sell_order_menu_root' sequence='1'
			groups='sell.sell_groups'/>
    	<menuitem id='sell_delivery_menu' name='销售发货单' action='sell_delivery_action'
			parent='sell_order_menu_root' sequence='2'/>
		<menuitem id="sell_return_menu" name='销售退货单' action="sell_return_action"
            parent="sell_order_menu_root" sequence="3"/>
        <menuitem id="sell_adjust_menu" name='销售变更单' action="sell_adjust_action"
            parent="sell_order_menu_root" sequence="4"
            groups='sell.sell_groups'/>

		<!-- 仓库菜单下增加菜单 -->
		<menuitem id='sell_wh_delivery_menu' name='销售发货单' action='sell_delivery_action'
			parent='warehouse.warehouse_order' sequence='1'/>
		<menuitem id="sell_wh_return_menu" name='销售退货单' action="sell_return_action"
            parent="warehouse.warehouse_order" sequence="2"/>
		<!-- 销售主数据 -->
		<menuitem id='menu_sell_master' name='主数据' parent='sell_menu' sequence="2"/>
		<menuitem id='sell_customer_menu' action='core.customer_action' name="客户" parent='menu_sell_master' sequence='10'/>
		<menuitem id='sell_goods_menu' name='商品' parent='menu_sell_master' action='goods_action_sell' sequence='20' />
		<menuitem id='pricing_menu' name='定价策略' action='action_pricing' parent='menu_sell_master' sequence='30'/>
		<!-- 销售报表 -->
		<menuitem id="menu_sell_report" name="报表" parent="sell_menu" sequence="3"/>
    </data>
</openerp>
