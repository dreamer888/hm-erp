<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<!--固定资产-->
		<record id='asset_tree' model='ir.ui.view'>
			<field name='name'>asset.tree</field>
			<field name='model'>asset</field>
			<field name='arch' type='xml'>
				<tree string='固定资产'>
                    <field name='code' optional="show"/>
					<field name='name' optional="show"/>
                    <field name='category_id' optional="show"/>
					<field name='cost' optional="show"/>
                    <field name='net_value' sum='净值合计' optional="show"/>
                    <field name="cost_depreciation" sum='每月折旧合计' optional="show"/>					
					<field name='no_depreciation' optional="show"/>
                    <field name='state' optional="show"/>
				</tree>
			</field>
		</record>

        <record id="asset_tree_filter" model="ir.ui.view">
            <field name="name">asset.select</field>
            <field name="model">asset</field>
            <field name="arch" type="xml">
                <search string="固定资产">
                    <field name="period_id"/>
                    <field name="name"/>
                    <field name="code"/>
                    <group expand="0" string="Group By">
                        <filter name="by_category_id" string="固定资产类别" domain="[]" context="{'group_by':'category_id'}"/>
                        <filter name="by_name" string="固定资产名称" domain="[]" context="{'group_by':'name'}"/>
                        <filter name="by_period" string="会计期间" domain="[]" context="{'group_by':'period_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <!--固定资产清理-->
        <record id="create_clean_wizard_form" model="ir.ui.view">
            <field name="name">create.clean.wizard</field>
            <field name="model">create.clean.wizard</field>
            <field name="arch" type="xml">
            	<form>
            		<group>
                        <group>
                            <field name="date"/>
                            <field name="period_id"/>
                            <field name="clean_cost"/>
                            <field name="residual_income"/>
                            <field name="bank_account"/>
                            <field name="sell_tax_amount"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_clean_account"  string="生成清理凭证" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>

        <!--固定资产变更-->
        <record id="create_chang_wizard_form" model="ir.ui.view">
            <field name="name">create.chang.wizard</field>
            <field name="model">create.chang.wizard</field>
            <field name="arch" type="xml">
            	<form>
            		<group>
                        <group>
                            <field name="chang_date"/>
                            <field name="period_id"/>
                            <field name="chang_cost"/>
                            <field name="chang_depreciation_number"/>
                            <field name="chang_tax"/>
                            <field name="chang_partner_id" domain="[('s_category_id', '!=', False)]" context="{'form_view_ref': 'core.supplier_address_form'}"/>
                        </group>
                        <group>
                            <field name="change_reason" required="1"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_chang_account"  string="生成变更凭证" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>
        
        <!-- form view在此前定义，后面的form view引用了这两个action，所以不能把它们放在action文件里 -->
        <!-- 固定资产清理 action -->
        <record id="create_clean_action" model="ir.actions.act_window">
            <field name="name">固定资产清理</field>
            <field name="res_model">create.clean.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="create_clean_wizard_form"/>
            <field name="target">new</field>
        </record>
        <!-- 固定资产变更 action -->
        <record id="create_chang_action" model="ir.actions.act_window">
            <field name="name">固定资产变更</field>
            <field name="res_model">create.chang.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="create_chang_wizard_form"/>
            <field name="target">new</field>
        </record>

		<!--固定资产-->
        <record id='asset_form' model='ir.ui.view'>
			<field name='name'>asset.form</field>
			<field name='model'>asset</field>
			<field name='arch' type='xml'>
                <form string="固定资产">
	                <header>
	                	<button name='asset_done' states="draft" string="确认" type="object" class="oe_highlight"/>
	                	<button name='asset_draft' states="done" string="撤销确认" type="object" />
                        <button name="%(create_clean_action)d" string="清理固定资产" type="action" class="btn-primary"
                        attrs="{'invisible': [('state', '!=', 'done')]}"/>
                        <button name="%(create_chang_action)d" string="变更固定资产" type="action" class="btn-primary"
                        attrs="{'invisible': [('state', '!=', 'done')]}"/>
	                    <field name="state" widget="statusbar" readonly="1"/>
	                </header>
			    	<sheet>
                        <group>
                            <group>
                                <field name='code'/>
                                <field name="name"/>
                                <field name="category_id"/>
                                <field name="cost"/>
                                <field name="surplus_value"/>
                            </group>
                            <group>
                                <field name="net_value"/>
                                <field name="no_depreciation"/>
                                <field name="depreciation_number"/>
                                <field name="depreciation_value"/>
                                <field name="cost_depreciation"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="account" string="入账">
                              <group>
                              <group>
                                <field name="period_id"/>
                                <field name="date"/>
                                <field name="tax"/>
                                <field name="amount"/>
                                <field name="partner_id" domain="[('s_category_id', '!=', False)]" context="{'form_view_ref': 'core.supplier_address_form'}"/>
                                <field name="bank_account"/>
                                <field name="is_init" groups='core.master_groups'/>
                                <field name="depreciation_previous" attrs="{'invisible': [('is_init', '=', False)]}" />
                              </group>
                              <group>
                                <field name="account_credit"/>
                                <field name="account_asset"/>
                                <field name="account_depreciation"/>
                                <field name="account_accumulated_depreciation"/>
                                <field name="auxiliary_id" options="{'no_open': True, 'no_create': True}"/>
                              </group>
                              </group>
                            </page>
                            <page name="depreciation" string="折旧">
                                <field name="line_ids">
                                     <tree string="折旧行" editable="bottom" create='0'>
                                         <field name="date" optional="show"/>
                                         <field name="period_id" optional="show"/>
                                         <field name="cost_depreciation" sum="合计折旧" optional="show"/>
                                     </tree>
                                </field>
                            </page>
                            <page name="change" string="变更">
                                 <field name="chang_ids">
                                      <tree string="变更明细" editable="bottom" create='0'>
                                          <field name="date" optional="show"/>
                                          <field name="period_id" optional="show"/>
                                          <field name="chang_name" optional="show"/>
                                          <field name="chang_before" optional="show"/>
                                          <field name="chang_after" optional="show"/>
                                          <field name="partner_id" optional="show"/>
                                          <field name="change_reason" optional="show"/>
                                          <field name="create_uid" string="变更人" optional="show"/>
                                      </tree>
                                 </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
			</field>
		</record>

		<!--固定资产 只读界面-->
        <record id='asset_form_readonly' model='ir.ui.view'>
			<field name='name'>asset.form</field>
			<field name='model'>asset</field>
			<field name='arch' type='xml'>
                <form string="固定资产" create="false" edit="false" delete="false">
	                <header>
	                    <field name="state" widget="statusbar" readonly="1"/>
	                </header>

                         <group>
                            <group>
                                <field name='code' readonly="1"/>
                                <field name="name" readonly="1"/>
                                <field name="category_id" readonly="1"/>
                                <field name="cost" readonly="1"/>
                                <field name="surplus_value" readonly="1"/>
                            </group>
                            <group>
                                <field name="net_value" readonly="1"/>
                                <field name="no_depreciation" readonly="1"/>
                                <field name="depreciation_number" readonly="1"/>
                                <field name="depreciation_value" readonly="1"/>
                                <field name="cost_depreciation" readonly="1"/>
                                <field name="auxiliary_id" readonly="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="account" string="入账">
                              <group>
                              <group>
                                <field name="period_id" readonly="1"/>
                                <field name="date" readonly="1"/>
                                <field name="tax" readonly="1"/>
                                <field name="amount" readonly="1"/>
                                <field name="partner_id" domain="[('s_category_id', '!=', False)]" context="{'form_view_ref': 'core.supplier_address_form'}" readonly="1"/>
                                <field name="bank_account" readonly="1"/>
                                <field name="is_init" groups='core.master_groups' readonly="1"/>
                                <field name="depreciation_previous" attrs="{'invisible': [('is_init', '=', False)]}" readonly="1"/>
                              </group>
                              <group>
                                <field name="account_credit" readonly="1"/>
                                <field name="account_asset" readonly="1"/>
                                <field name="account_depreciation" readonly="1"/>
                                <field name="account_accumulated_depreciation" readonly="1"/>
                              </group>
                              </group>
                            </page>
                            <page name="depreciation" string="折旧">
                                <field name="line_ids">
                                     <tree string="折旧行" editable="bottom" create='0'>
                                         <field name="date" optional="show" readonly="1"/>
                                         <field name="period_id" optional="show" readonly="1"/>
                                         <field name="cost_depreciation" sum="合计折旧" optional="show" readonly="1"/>
                                     </tree>
                                </field>
                            </page>
                            <page name="change" string="变更">
                                 <field name="chang_ids">
                                      <tree string="变更明细" editable="bottom" create='0'>
                                          <field name="date" optional="show" readonly="1"/>
                                          <field name="period_id" optional="show" readonly="1"/>
                                          <field name="chang_name" optional="show" readonly="1"/>
                                          <field name="chang_before" optional="show" readonly="1"/>
                                          <field name="chang_after" optional="show" readonly="1"/>
                                          <field name="partner_id" optional="show" readonly="1"/>
                                          <field name="change_reason" optional="show" readonly="1"/>
                                          <field name="create_uid" string="变更人" optional="show" readonly="1"/>
                                      </tree>
                                 </field>
                            </page>
                        </notebook>

                    <footer>
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>

                </form>
			</field>
		</record>


		<!--固定资产折旧明细-->
        <record id='asset_line_tree' model='ir.ui.view'>
			<field name='name'>asset.line.tree</field>
			<field name='model'>asset.line</field>
			<field name='arch' type='xml'>
				<tree string='固定资产折旧明细' create='0' delete='0'>
                    <field name='code' optional="show"/>
					<field name='order_id' optional="show"/>
                    <button name="view_asset" string="" help="查看资产卡片" type="object"
                        class="oe_inline fa fa-arrow-right oe_link"/>
                    <field name="category_id"/>
					<field name='period_id' optional="show"/>
					<field name='cost_depreciation' string="本期折旧额" optional="show"/>
					<field name='no_depreciation' optional="show"/>
					<field name='net_value' optional="show"/>
				</tree>
			</field>
		</record>

        <record id='asset_line_pivot' model='ir.ui.view'>
			<field name='name'>asset.line.pivot</field>
			<field name='model'>asset.line</field>
			<field name='arch' type='xml'>
				<pivot string='固定资产折旧明细'>
					<field name='period_id' type="row"/>
                    <field name="category_id"  type="row"/>
					<field name='name' type="row"/>
					<field name='cost_depreciation' type='measure'/>
				</pivot>
			</field>
		</record>

        <record id="asset_line_tree_filter" model="ir.ui.view">
            <field name="name">asset.line.select</field>
            <field name="model">asset.line</field>
            <field name="arch" type="xml">
                <search string="固定资产折旧分类">
                    <field name="period_id"/>
                    <field name="name"/>
                    <field name="code"/>
                    <group expand="0" string="Group By">
                        <filter name="by_category_id" string="固定资产类别" domain="[]" context="{'group_by':'category_id'}"/>
                        <filter name="by_name" string="固定资产名称" domain="[]" context="{'group_by':'name'}"/>
                        <filter name="by_period" string="会计期间" domain="[]" context="{'group_by':'period_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <!--固定资产折旧-->
        <record id="create_depreciation_wizard_form" model="ir.ui.view">
            <field name="name">create.depreciation.wizard.form</field>
            <field name="model">create.depreciation.wizard</field>
            <field name="arch" type="xml">
            	<form>
            		<group>
                        <group>
                            <field name="date" style="width: 45%%"/>
                            <field name="period_id"  style="width: 45%%"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_depreciation"  string="查看折旧明细表" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>

		<!--固定资产分类-->
        <record id='asset.category_tree' model='ir.ui.view'>
			<field name='name'>asset.category.tree</field>
			<field name='model'>asset.category</field>
			<field name='arch' type='xml'>
				<tree editable="top" string='固定资产分类'>
					<field name='name' optional="show"/>
					<field name='account_accumulated_depreciation' optional="show"/>
					<field name='account_asset' optional="show"/>
					<field name='account_depreciation' optional="show"/>
                    <field name='depreciation_number' optional="show"/>
					<field name='depreciation_value' optional="show"/>
					<field name='clean_income' optional="show"/>
                    <field name='clean_costs' optional="show"/>
                    <field name='active' invisible='1' optional="show"/>
				</tree>
			</field>
		</record>

        <record id="init_asset_form" model="ir.ui.view">
            <field name="name">init.asset.form</field>
            <field name="model">voucher</field>
            <field name="inherit_id" ref="finance.voucher_form"/>
            <field name="arch" type="xml">
                <button  name="voucher_done" position="after">
                	<field name='is_init' invisible='1'/>
                    <button name='init_asset' string="引入固定资产" type="object" class="oe_highlight" attrs="{'invisible': ['|',('is_init', '=', False), ('state', '=', 'done')]}"/>
                </button>
            </field>
        </record>
	</data>
</openerp>