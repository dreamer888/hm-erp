<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="mrp_plm_tree" model="ir.ui.view">
        <field name="name">mrp.plm.tree</field>
        <field name="model">mrp.plm</field>
        <field name="arch" type="xml">
            <tree string='生产加工单登记簿' decoration-info='state == "draft"' decoration-muted= 'state == "cancel"' >
                <field name='name'  optional="show"/>
                <field name='date'  optional="show"/>
                <field name='delivery_date'  optional="show"/>
                <field name='partner_id' optional="show"/>
                <field name='user_id' optional="show"/>
                <field name='department_id' optional="show"/>
                <field name='goods_id' optional="show"/>
                <field name='uom_id' domain="[('id', '!=', parent.id)]" optional="show" context="{'goods_id':goods_id}"/>
                <field name='qty' optional="show"/>
                <field name='warehouse_id' optional="show"/>
                <field name='remark' optional="show"/>
                <field name='qty_in' optional="show"/>
                <field name='qty_cons' optional="show"/>
                <field name='state' optional="show"/>
            </tree>
        </field>
    </record>

    <record id='mrp_plm_form' model='ir.ui.view'>
        <field name='name'>mrp.plm.form</field>
        <field name='model'>mrp.plm</field>
        <field name='arch' type='xml'>
            <form string='生产加工单据内容' class="o_sale_order">
                <header>
                    <button name='button_done' states='draft' string='确认' type='object' class='oe_highlight'/>
                    <button name="button_draft" states="done" string="撤销" type="object"/>
                    <button name="button_retu" states="done" string="退料" type="object"/>
                    <button name="button_cons_add" states="done" string="补料" type="object"/>
                    <field name='state' widget='statusbar' statusbar_visible="draft,done"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object" name="action_view_plm_in" class="oe_stat_button" icon="fa-truck"
                                attrs="{'invisible':['|', ('state', 'in', ('draft')), ('plm_in_count', '=', 0)]}">
                            <field name="plm_in_count" widget="statinfo" string="入库" help=""/>
							<field name="plm_in_ids" invisible="1"/>
                        </button>
                        <button type="object" name="action_view_plm_cons" class="oe_stat_button" icon="fa-truck"
                                attrs="{'invisible':['|', ('state', 'in', ('draft')), ('plm_cons_count', '=', 0)]}">
                            <field name="plm_cons_count" widget="statinfo" string="领料" help=""/>
							<field name="plm_cons_ids" invisible="1"/>
                        </button>
                        <button type="object" name="action_view_plm_cons_retu" class="oe_stat_button" icon="fa-truck"
                                attrs="{'invisible':['|', ('state', 'in', ('draft')), ('plm_cons_retu_count', '=', 0)]}">
                            <field name="plm_cons_retu_count" widget="statinfo" string=" 退料" help=""/>
							<field name="plm_cons_retu_ids" invisible="1"/>
                        </button>
                        <button type="object" name="action_view_plm_cons_add" class="oe_stat_button" icon="fa-truck"
                                attrs="{'invisible':['|', ('state', 'in', ('draft')), ('plm_cons_add_count', '=', 0)]}">
                            <field name="plm_cons_add_count" widget="statinfo" string=" 补料" help=""/>
							<field name="plm_cons_add_ids" invisible="1"/>
                        </button>
                        <button type="object" name="action_view_plm_task" class="oe_stat_button" icon="fa-truck"
                                attrs="{'invisible':['|', ('state', 'in', ('draft')), ('plm_task_count', '=', 0)]}">
                            <field name="plm_task_count" widget="statinfo" string="生产任务" help=""/>
							<field name="plm_task_ids" invisible="1"/>
                        </button>
                        <button type="object" name="action_view_plm_ous" class="oe_stat_button" icon="fa-truck"
                                attrs="{'invisible':['|', ('state', 'in', ('draft')), ('plm_ous_count', '=', 0)]}">
                            <field name="plm_ous_count" widget="statinfo" string="委外任务" help=""/>
							<field name="plm_ous_ids" invisible="1"/>
                        </button>
                    </div>
                    <group>
                        <group>
                            <field name='date' optional="show"/>
                            <field name='delivery_date' optional="show"/>
                            <field name='department_id' optional="show"/>
                            <field name='warehouse_id' optional="show"/>
					        <field name='user_id'  optional="show"/>
                            <field name="partner_id" optional="show"/>
                            <field name='type' optional="show"/>
                        </group>
                        <group>
                            <field name='goods_id' optional="show"/>
                            <field name='bom_id'  optional="show"/>
                            <field name='uom_id' optional="show"/>
                            <field name='qty' optional="show"/>
                            <field name='qty_in' optional="show"/>
                            <field name='qty_cons' optional="show"/>
                            <field name='is_close' optional="show"/>
                        </group>
                    </group>
                    <group>
                        <field name='remark' optional="show"/>
                    </group>
                    <notebook>
                        <page name="lines" string="物料">
                            <field name="mrp_proc_ids" invisible="1"/>
                            <field name='line_ids'>
                                <tree string='物料' editable='bottom'>
                                    <field name='goods_id'  optional="show"/>
                                    <field name='uom_id' optional="show"/>
                                    <field name='qty_bom' optional="show"/>
                                    <field name='qty' sum='数量合计' optional="show"/>
                                    <field name="qty_waste" optional="show"/>
                                    <field name="radix" optional="show"/>
                                    <field name="rate_waste" optional="show"/>
                                    <field name='qty_consed' optional="show"/>
                                    <field name='qty_cons' optional="hide"/>
                                    <field name='qty_retu' optional="hide"/>
                                    <field name='warehouse_id' optional="show"/>
                                    <field name='mrp_proc_id' optional="show"
                                           domain="[('id', 'in', parent.mrp_proc_ids)]"/>
                                    <field name='remark' optional="show"/>
                                </tree>
                            </field>
                        </page>
                        <page name="proc_lines" string="工艺线路">
                            <field name="line_proc_ids">
                                <tree string="工艺线路" editable='bottom'>
                                    <field name="sequence" widget="handle"/>
                                    <field name="mrp_proc_id" optional="show"/>
                                    <field name="down" optional="show"/>
                                    <field name='proc_ctl' optional="show"/>
                                    <field name="need_qc" optional="show"/>
                                    <field name="workcenter_id" optional="show"/>
                                    <field name="qc_department_id" optional="hide"/>
                                    <field name="get_way" optional="show"/>
                                    <field name="rate_self" optional="show"/>
                                    <field name="qty_proc" optional="show"/>
                                    <field name="qty" optional="show" />
                                    <field name="sub_remark" optional="hide"/>
                                    <field name="rate_waste" optional="show"/>
                                    <field name="time_uom" optional="hide"/>
                                    <field name="pre_time" optional="hide"/>
                                    <field name="work_time" optional="hide"/>
                                    <field name="price_std" optional="hide"/>
                                    <field name="price" optional="hide"/>
                                    <field name="remark" optional="show"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!--生产加工单 action-->
    <record id='mrp_plm_action' model='ir.actions.act_window'>
        <field name='name'>生产加工单</field>
        <field name='res_model'>mrp.plm</field>

        <field name='view_mode'>tree,form</field>
        <field name='view_id' ref='mrp_plm_tree'/>
        <field name="context">{'warehouse_type': 'stock','search_default_user_id':1}</field>
        <field name="help" type="html">
           <p class="oe_view_nocontent_create">

           </p>
         </field>
    </record>
</odoo>