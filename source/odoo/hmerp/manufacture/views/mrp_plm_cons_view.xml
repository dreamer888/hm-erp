<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="mrp_plm_cons_tree" model="ir.ui.view">
        <field name="name">mrp.plm.cons.tree</field>
        <field name="model">mrp.plm.cons</field>
        <field name="arch" type="xml">
            <tree string='生产领料' colors='blue:state == "draft";lightgray:state == "cancel"'>
                <field name='name'  optional="show"/>
                <field name="plm_id" optional="show"  string="生产加工单"/>
                <field name='date'  optional="show"/>
                <field name='department_id' optional="show"/>
                <field name='user_id' optional="show"/>
                <field name='warehouse_id' optional="show"/>
                <field name='warehouse_dest_id' optional="show"/>
                <field name='note' optional="show"/>
                <field name='state' optional="show"/>
            </tree>
        </field>
    </record>

    <record id='mrp_plm_cons_form' model='ir.ui.view'>
        <field name='name'>mrp.plm.cons.form</field>
        <field name='model'>mrp.plm.cons</field>
        <field name='arch' type='xml'>
            <form string='生产领料'>
                <header>
                    <button name='button_done' states='draft' string='发料' type='object' class='oe_highlight'/>
                    <button name="button_draft" states="done" string="撤回" type="object"/>
                    <field name='state' widget='statusbar' statusbar_visible="draft,done"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="plm_id" optional="show" string="生产加工单"/>
                            <field name='date' optional="show"/>
                            <field name='department_id' optional="show"/>
                            <field name='user_id' optional="show"/>
                        </group>
                        <group>
                            <field name='warehouse_id' optional="show"/>
                            <field name='warehouse_dest_id'/>
                        </group>
                    </group>
                    <group>
                        <field name='note' optional="show"/>
                    </group>
                    <notebook>
                    	<page name="lines" string="领料明细">
		                    <field name="line_out_ids" attrs="{'readonly': [('state','!=','draft')]}"
		                    	context="{
		                    	'type':'out',
		                    	}">
		                    	<tree string="领料明细" editable="bottom">
		                            <field name="goods_id" required='1' optional="show"/>
                                    <field name="warehouse_id" invisible="1"/>
		                            <field name="attribute_id"
		                            	domain="[('goods_id', '=', goods_id)]"
		                            	groups='goods.multi_attrs_groups'
		                            	attrs="{'required': [('using_attribute','=', True)], 'readonly': [('using_attribute','!=', True)],}" optional="show"/>
		                            <field name='lot_id' groups='goods.batch_groups'
											attrs="{'readonly': [('using_batch', '=', False)], 'required': [('using_batch', '=', True)]}" optional="show"/>
                                    <field name='expiration_date' groups='warehouse.group_expiration_date'  optional="show"/>
                                    <field name='location_id' groups="warehouse.multi_location_groups"
                                           options="{'no_open': True, 'no_create': True}"
                                           domain="['&amp;',('warehouse_id', '=', parent.warehouse_dest_id),'|',('goods_id', '=', goods_id),('goods_id', '=', False)]" optional="show"/>
		                            <field name="goods_uos_qty" sum="合计辅助数量"
		                            	groups="goods.auxiliary_unit_groups" optional="show"/>
		                            <field name='uos_id' groups='goods.auxiliary_unit_groups'  optional="show"/>
		                            <field name="qty_cons_pending" sum="合计数量" optional="show" attrs="{'invisible':[('state', 'in', ('done'))]}"/>
		                            <field name="goods_qty" sum="合计数量" optional="show" />
		                            <field name="uom_id" optional="show"/>
                                    <field name="type" invisible="1" optional="show"/>
		                            <field name='using_attribute' invisible='1' optional="show"/>
		                            <field name='using_batch' invisible='1' optional="show"/>
				                    <field name='force_batch_one' invisible='1' optional="show"/>
				                    <field name='state' invisible='1' optional="show"/>
		                        </tree>
		                    </field>
		                </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!--生产领料 action-->
    <record id='mrp_plm_cons_action' model='ir.actions.act_window'>
        <field name='name'>生产领料</field>
        <field name='res_model'>mrp.plm.cons</field>

        <field name='view_mode'>tree,form</field>
        <field name='view_id' ref='mrp_plm_cons_tree'/>
        <field name="help" type="html">
           <p class="oe_view_nocontent_create">

           </p>
        </field>
    </record>
</odoo>